diff --git a/configure b/configure
index 18f0518..4429ad0d 100755
--- a/configure
+++ b/configure
@@ -2779,7 +2779,7 @@ msvc_common_flags(){
             -lavifil32)           echo vfw32.lib ;;
             -lavicap32)           echo vfw32.lib user32.lib ;;
             -l*)                  echo ${flag#-l}.lib ;;
-            -L*)                  echo -libpath:${flag#-L} ;;
+            -L*)                  echo -LIBPATH:`cygpath -w ${flag#-L}` ;;
             *)                    echo $flag ;;
         esac
     done
@@ -3118,6 +3118,10 @@ host_ldflags_filter=$_flags_filter
 add_host_ldflags $_flags $_ldflags
 HOSTLD_O=${_ld_o-$HOSTLD_O}
 
+_ldflags=$LDFLAGS
+LDFLAGS=
+add_ldflags $_ldflags
+
 if [ -z "$CC_DEPFLAGS" ] && [ "$dep_cc" != "$cc" ]; then
     probe_cc depcc "$dep_cc"
     CCDEP=${_DEPCMD:-$DEPCMD}
@@ -3774,10 +3778,10 @@ case $libc_type in
         add_compat strtod.o strtod=avpriv_strtod
         ;;
     msvcrt)
-        add_compat strtod.o strtod=avpriv_strtod
-        add_compat msvcrt/snprintf.o snprintf=avpriv_snprintf   \
-                                     _snprintf=avpriv_snprintf  \
-                                     vsnprintf=avpriv_vsnprintf
+#        add_compat strtod.o strtod=avpriv_strtod
+#        add_compat msvcrt/snprintf.o snprintf=avpriv_snprintf   \
+#                                     _snprintf=avpriv_snprintf  \
+#                                     vsnprintf=avpriv_vsnprintf
         ;;
 esac
 
diff --git a/libavcodec/dxva2_internal.h b/libavcodec/dxva2_internal.h
index 3b651a4..1e04916 100644
--- a/libavcodec/dxva2_internal.h
+++ b/libavcodec/dxva2_internal.h
@@ -34,6 +34,8 @@
 #include "d3d11va.h"
 #endif
 #if HAVE_DXVA_H
+/* dxva.h defines nothing otherwise but it works */
+#define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
 #include <dxva.h>
 #endif
 
diff --git a/libavutil/internal.h b/libavutil/internal.h
index 800680a..e4b776e 100644
--- a/libavutil/internal.h
+++ b/libavutil/internal.h
@@ -130,7 +130,7 @@
 
 #include "libm.h"
 
-#if defined(_MSC_VER)
+#if defined(_MSC_VER) && _MSC_VER < 1900
 #pragma comment(linker, "/include:"EXTERN_PREFIX"avpriv_strtod")
 #pragma comment(linker, "/include:"EXTERN_PREFIX"avpriv_snprintf")
 #endif

