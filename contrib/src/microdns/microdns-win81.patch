--- microdns/compat/compat.h	2017-10-09 15:05:07.699932100 +0200
+++ microdns/compat/compat.h.msvc81	2017-10-09 15:05:03.863340900 +0200
@@ -60,12 +60,8 @@ static inline int os_wouldblock(void) {r
 #if defined (_WIN32)
 
 # include <stdint.h>
+# include <windows.h>
+#if defined(_WIN32_WINNT) && _WIN32_WINNT <= 0x603
+#undef WINAPI_FAMILY
+#define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
+#endif
 # include <winsock2.h>
-# include <windows.h>
 # include <ws2tcpip.h>
 # include <iphlpapi.h>
 
--- microdns/configure.ac	2017-10-09 15:15:57.839744500 +0200
+++ microdns/configure.ac.msvc81	2017-10-09 15:10:57.411898400 +0200
@@ -223,10 +223,6 @@ AC_LINK_IFELSE([
         # if _WIN32_WINNT < 0x600
         #  error Needs vista+
         # endif
+        # if _WIN32_WINNT <= 0x603
+        #  undef WINAPI_FAMILY
+        #  define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
+        # endif
         #include <ws2tcpip.h>
         #else
         #include <sys/socket.h>
@@ -240,10 +236,6 @@ AC_LINK_IFELSE([
         # if _WIN32_WINNT < 0x600
         #  error Needs vista+
         # endif
+        # if _WIN32_WINNT <= 0x603
+        #  undef WINAPI_FAMILY
+        #  define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
+        # endif
         #include <winsock2.h>
         #else
         #include <poll.h>
@@ -259,10 +251,6 @@ AC_CHECK_TYPES([struct pollfd],,,
 #if HAVE_POLL
 # include <poll.h>
 #elif defined (_WIN32)
+# if _WIN32_WINNT <= 0x603
+#  undef WINAPI_FAMILY
+#  define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
+# endif
 # include <winsock2.h>
 #endif
 ])
