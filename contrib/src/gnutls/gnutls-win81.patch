--- gnutls/lib/gnutls_x509.c	2017-07-12 09:52:10.588755500 +0200
+++ gnutls/lib/gnutls_x509.c.msvc81	2017-10-09 13:03:43.073793700 +0200
@@ -48,6 +48,8 @@
 #include "system-keys.h"
 #include "urls.h"
 #ifdef _WIN32
+#undef WINAPI_FAMILY
+#define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
 #include <wincrypt.h>
 #endif
 
--- gnutls/lib/nettle/rnd-common.c	2015-01-19 18:38:09.000000000 +0100
+++ gnutls/lib/nettle/rnd-common.c.msvc81	2017-10-09 13:20:15.025872800 +0200
@@ -27,6 +27,10 @@
  * and modified to fit gnutls' needs. Relicenced with permission. 
  * Original author Niels MÃ¶ller.
  */
+ 
+ #ifdef _WIN32
+#include <wincrypt.h>
+#endif
 
 #include <gnutls_int.h>
 #include <gnutls_errors.h>
--- gnutls/lib/system.c	2017-07-12 09:52:10.349255600 +0200
+++ gnutls/lib/system.c.msvc81	2017-10-09 13:26:12.825712300 +0200
@@ -20,6 +20,10 @@
  *
  */
 
+#ifdef _WIN32
+#include <wincrypt.h>
+#endif
+
 #include <config.h>
 #include <system.h>
 #include <gnutls_int.h>
@@ -32,8 +36,8 @@
 #include <c-ctype.h>
 
 #ifdef _WIN32
-# include <windows.h>
-# include <wincrypt.h>
+# undef WINAPI_FAMILY
+# define WINAPI_FAMILY WINAPI_FAMILY_DESKTOP_APP
 # include <winapifamily.h>
 # if (WINAPI_FAMILY == WINAPI_FAMILY_PC_APP || WINAPI_FAMILY == WINAPI_FAMILY_PHONE_APP)
 #  if defined(_WIN32_WINNT) && _WIN32_WINNT >= 0x0A00 /* Univeral Winstore */
